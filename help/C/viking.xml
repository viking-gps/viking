<?xml version="1.0"?>
<!DOCTYPE article PUBLIC "-//OASIS//DTD DocBook XML V4.1.2//EN"
"http://www.oasis-open.org/docbook/xml/4.1.2/docbookx.dtd" [
  <!ENTITY appname          "Viking">
  <!ENTITY app "<application>Viking</application>">
  <!ENTITY appversion   "1.2">
  <!ENTITY manrevision  "0.2">
  <!ENTITY date "June 2011">
]>
<!--
      (Do not remove this comment block.)
  Maintained by the GNOME Documentation Project
  http://live.gnome.org/DocumentationProject
  Template version: 3.0 beta
  Template last modified 2006-11-21

-->
<!-- =============Document Header ============================= -->
<article id="index" lang="en">
  <articleinfo>
    <title>&app; Manual</title>
    <abstract role="description">
      <para>&app; is a free/open source program to manage GPS data.</para>
    </abstract>

    <copyright>
      <year>2009</year>
      <holder>Guilhem Bonnefille</holder>
    </copyright>

    <!-- An address can be added to the publisher information. -->
    <publisher role="maintainer">
      <publishername>GNOME Documentation Project</publishername>
    </publisher>

    <xi:include href="legal.xml" xmlns:xi="http://www.w3.org/2001/XInclude"/>
    <!-- The file legal.xml contains link to license for the documentation,
        and other legal stuff such as "NO WARRANTY" statement.
        Please do not change any of this. -->

    <authorgroup>
      <author>
        <firstname>Guilhem</firstname>
        <surname>Bonnefille</surname>
      </author>
      <author>
        <firstname>Rob</firstname>
        <surname>Norris</surname>
      </author>
      <!-- Contributors from the Wiki history -->
      <author>
        <firstname>username:</firstname>
        <surname>Alexxy</surname>
      </author>
      <author>
        <firstname>username:</firstname>
        <surname>Vikingis</surname>
      </author>
      <author>
        <firstname>username:</firstname>
        <surname>Tallguy</surname>
      </author>
      <author>
        <firstname>username:</firstname>
        <surname>EliotB</surname>
      </author>
      <author>
        <firstname>Alex</firstname>
        <surname>Foobarian</surname>
      </author>
      <!-- END -->
    </authorgroup>

    <revhistory>
      <revision>
        <revnumber>&appname; Manual V&manrevision;</revnumber>
        <date>&date;</date>
        <revdescription>
          <para role="author">Guilhem Bonnefille <email>guilhem.bonnefille@gmail.com</email></para>
          <para role="publisher">GNOME Documentation Project</para>
        </revdescription>
      </revision>
    </revhistory>

    <releaseinfo>This manual describes version &appversion; of &appname;.</releaseinfo>

    <legalnotice>
      <title>Feedback</title>
      <para>To report a bug or make a suggestion regarding the &app; application or
      this manual, follow the directions in the
      <ulink url="ghelp:user-guide?feedback-bugs" type="help">Feedback section of the GNOME User Guide</ulink>.
      </para>
    </legalnotice>
  </articleinfo>

  <indexterm zone="index">
    <primary>&app;</primary>
  </indexterm>
<!-- ============= Document Body ============================= -->
<section id="introduction">
  <title>Introduction</title>
<para>
&appname; aims to be easy to use, yet powerful in accomplishing a wide
variety of tasks. Some of the things you can use &appname; for are:
</para>
<itemizedlist mark="opencircle"><listitem>
<para>
Uploading and downloading waypoints, tracks to/from GPS.
</para>
</listitem>
<listitem>
<para>Preparing tracks and waypoints for trips using maps from services
such as OpenStreetMap (OSM) and/or Terrasever. The data is only needed to be uploaded to
your GPS before you leave. The maps together with your tracks and
waypoints can also be printed and used during the trip.
</para>
</listitem>
<listitem>
<para>
After trips, tracks and waypoints from GPS can be downloaded, stored, managed and reused in your (or your friends') later trips.
</para>
</listitem>
<listitem>
<para>
Analyzing Off Highway Vehicle (OHV) and hiking trips, understanding where you went and how far you were from something.
</para>
</listitem>
<listitem>
<para>Making waypoints and tracks to follow to easily get someplace
you've never been before or don't have GPS data for but online
maps exist for it.
</para>
</listitem>
<listitem>
<para>
Making maps with coordinate lines.
</para>
</listitem>
<listitem>
<para>
Grouping data from multiple trips using a hierarchical data manager.
</para>
</listitem>
<listitem>
<para>
Analyzing speed at different places (to some degree), adding waypoints where you forgot to mark one but did slow down or stop.
</para>
</listitem>
<listitem>
<para>
Downloading and storing OpenStreetMap and/or Terraserver maps on your hard drive and looking at them later.
</para>
</listitem>
<listitem>
<para>
Editing tracks and trackpoints, joining and splitting up tracks 
</para>
</listitem>
<listitem>
<para>
Show the live GPS position on the map (for use on a mobile device - e.g. a laptop)
</para>
</listitem>
<listitem>
<para>
Import track+waypoint files of various types via GPSBabel
</para>
</listitem>
<listitem>
<para>
View, create and update Geotagged Images (using EXIF data).
</para>
</listitem>
</itemizedlist>
<note>
<para>
&appname; is under continual improvement: see the potential areas in the <ulink url="http://sourceforge.net/apps/mediawiki/viking/index.php?title=Main_Page#TODO_.2F_Ideas"><citetitle>Roadmap / Wishlist</citetitle></ulink>:
</para>
</note>
</section>

<section><title>General Concepts</title>
<section><title>Layers</title>
<para>
'Layers' is concept one may know from powerful graphics editors such as Photoshop or GIMP.
Instead of putting all the data on the same level, it is stacked (i.e. layered) with different data over one another.
This can make useful for analysis and general handling of various sets of data.
</para>
<para>
Unfortunately the downside of this complexity is remembering how differing layers of data can obscure other data.
</para>
<para>
The Map layers have <ulink url="http://en.wikipedia.org/wiki/Alpha_compositing"><citetitle>Alpha Compositing</citetitle></ulink>,
to create the appearance of partial transparency.
By controlling this value one can see data below it in the layer heirarchy for interesting effects.
</para>
</section>
<section><title>Layers Panel</title>
<para>
The panel on the left is called the <emphasis role="bold">layers panel</emphasis>.
It determines which layers and sublayers (such as tracks and waypoints)
are shown, and the order in which they are drawn. Layers list on the
top of the layers panel are drawn last. You can change the order by
drag and drop, or by selecting a layer and using the up and down
buttons at the bottom of the layers panel.
</para>
</section>
<section><title>Viewport</title>
<para>
The main &appname; area where the layer data is drawn, is called the <emphasis role="bold">viewport</emphasis>.
</para>
</section>
<section><title>Statusbar</title>
<para>This provides a readout of various information:</para>
<itemizedlist>
<listitem><para>The currently selected (mouse pointer) tool</para></listitem>
<listitem><para>The number of items to process in the background - normally this the number in the map tile download queue</para></listitem>
<listitem><para>The zoom factor</para></listitem>
<listitem><para>The location of the mouse pointer (and potentially height information if DEM data is available)</para></listitem>
</itemizedlist>
</section>

<section><title>Projections</title>
<para>
&appname; supports differents projections:
<itemizedlist>
<listitem>
<para>UTM</para>
</listitem>
<listitem>
<para>LatLon (also called EPSG:4326)</para>
</listitem>
<listitem>
<para>Mercator (also called Spherical Mercator)</para>
</listitem>
</itemizedlist>
</para>
</section>
</section>

<section><title>Layers</title>

<para>
Layers supported by &appname; are:
</para>
<itemizedlist>
<listitem><para>Aggregate</para></listitem>
<listitem><para>TrackWaypoint</para></listitem>
<listitem><para>GPS</para></listitem>
<listitem><para>DEM</para></listitem>
<listitem><para>Coord</para></listitem>
<listitem><para>Map</para></listitem>
<listitem><para>GeoRef</para></listitem>
</itemizedlist>
<para>
For each layer there are a few standard options:
</para>
<itemizedlist>
<listitem><para>Properties - Layer setup / configuration settings</para></listitem>
<listitem><para>Cut</para></listitem>
<listitem><para>Copy</para></listitem>
<listitem><para>Paste</para></listitem>
<listitem><para>Delete</para></listitem>
<listitem><para>Visibility - This checkbox on the Layers Panel controls whether the layer is shown in the viewport or not</para></listitem>
</itemizedlist>
<para>
The cut/copy/paste options can be accessed in a variety of ways once the layer has been selected:
</para>
<itemizedlist>
<listitem><para>Standard keys: <keycap>Ctrl+x|c|v</keycap></para></listitem>
<listitem><para>Main menu <guimenuitem>Edit</guimenuitem></para></listitem>
<listitem><para>From the right click menu</para></listitem>
<listitem><para>Buttons at the bottom of the Layers Panel</para></listitem>
</itemizedlist>
<para>
See the individual section for detail about each layer.
</para>

<section><title>TrackWaypoint Layer</title>
<para>
TrackWaypoint layers display GPS data (tracks and waypoints).
</para>
<para>One way to create new waypoints is to copy a
latitude/longitude coordinate pair, such as the one shown on most
geocaches, and paste it into an active TrackWaypoint layer. &appname; can
automatically recognize several variations of the lat/lon format.
</para>
<para>
By right-clicking tracks and waypoints in the layers panel, you can do
many things with tracks and waypoints. You can easily find a specific
track or waypoint by expanding the Tracks or Waypoints sublayers in the
layers panel to show all tracks or waypoints, and typing the name of
the track/waypoint.
</para>

<section><title>Layer Operations</title>
<para>
The layer has a context menu with several operations.
</para>

<section><title>View Layer</title>
<para>
Version1.1+: This will automatically move the viewport and select the best zoom level to see the whole layer (i.e. tracks and waypoints).
</para>
</section>

<section><title>View All Tracks</title>
<para>
Version1.1+: This will automatically move the viewport and select the best zoom level to see the all the tracks in the layer (ignoring positions of any waypoints).
</para>
</section>

<section><title>View All Waypoints</title>
<para>
Version1.1+: This will automatically move the viewport and select the best zoom level to see the all the waypoints in the layer (ignoring positions of any tracks).
</para>
</section>

<section><title>Goto Center of Layer</title>
<para>
This will automatically move the viewport to see the whole layer (i.e. tracks and waypoints). It does not adjust the zoom level.
</para>
</section>

<section><title>Goto Waypoint</title>
<para>
This opens a dialog box to enter a name of waypoint to search for. If it is found the viewport is centred on it.
</para>
<note>
<para>
Note this search is not very clever and only finds exact matches.
You are probably better off expanding the waypoint list and directly start typing, as mentioned above, which finds a match based on each letter typed.
</para>
</note>
</section>

<section><title>Export Layer</title>
<para>
The layer (all tracks and waypoints) can be exported to a file GPX, GPSPoint, GPSMapper or Google's KML format.
</para>
<para>
Version1.1+: An individual track can be exported to a GPX file via the track menu.
</para>
</section>

<section id="new_wp"><title>New Waypoint</title>
<para>
This opens a dialog box to create a new waypoint. A default name will be suggested and the default position is the center of the viewport.
</para>
</section>

<section><title>Add Wikipedia Waypoints</title>
<para>
This gets 'interesting' points from Wikipedia for the specified view: either within the extent of layer bounds or within the current viewport boundary.
</para>
</section>

<section><title>Geotag Images</title>
<para>
This starts the Geotagging Images dialog against all tracks in the layer.
See <link linkend="geotagging">Geotagging</link> for further detail.
</para>
</section>

<section id="osm_upload"><title>Upload To OSM</title>
<para>
This opens a dialog to upload all tracks and waypoints to <ulink url="http://openstreetmap.org/">OpenStreetMap</ulink> traces.
Useful if you are an OpenStreetMap contributor (you will need an OpenStreetMap account), these details can be stored in &appname; <link linkend="prefs_osm">preferences.</link>
</para>
<para>
 &appname; allows you to edit a track, e.g. remove duplicate points, perhaps remove track points leading to your home and then upload it to OpenStreetMap.
</para>
<note>
<para>
 <emphasis role="bold">Warning!</emphasis>
The password is transferred <emphasis role="bold">unencrypted</emphasis> in every request sent to the OpenStreetMap server. This is due to the use of OpenStreetMap's basic authentication method.
</para>
<para>Currently &appname; does not support the <ulink url="http://oauth.net/">OAuth</ulink> mechanism.</para>
</note>
</section>

<section><title>Filter</title>
<section><title>Simplify All Tracks</title>
<para>
This opens dialog to request the number of points each track will be simplified using <application>GPSBabel</application>. The result is put into a new layer. The simplification method removes points considered to be in a 'near straight line', thus reducing the number of points and attempting to keep the most important turning points.
</para>
</section>
<section><title>Remove Duplicate Waypoints</title>
<para>
Remove Duplicate Waypoints - fairly self explainatory, with the results created in a new layer.
</para>
<note>
<para>
However it only considers a precise position (waypoints only 1 metre away from each other are considered different) and also doesn't consider if the waypoints have different comments, symbols or images.
</para>
</note>
</section>
</section>

<section id="filter_with_track"><title>Filter With <emphasis>Trackname</emphasis></title>
<para>
This runs <application>GPSBabel</application> on the layer using information from a previously selected track (select via the track menu "Use With Filter" option) with the following command types:
</para>
<itemizedlist>
<listitem><para>Waypoints Inside This</para></listitem>
<listitem><para>Waypoints Outside This</para></listitem>
</itemizedlist>
<para>
The result is generated in a new Track/Waypoint layer.
</para>
</section>

<section><title>Geotag Images</title>
<para>
This starts the Geotagging Images dialog using the specific track.
See <link linkend="geotagging">Geotagging</link> for further detail.
</para>
</section>

</section><!-- End TRW Layer Options -->

<section><title>Track Properties</title>
<para>
Show many useful statistics about a track, including a
elevation-distance graph and a speed-time graph (if data is available).
You can click these graphs to jump to the point in the track. You can
also reverse a track, delete duplicates, and split a track from its
component segments (discontinuous breaks in a track) into separate
tracks.
</para>
<para>
The following colors are used in the elevation-distance graph:
</para>
<variablelist>
<varlistentry>
<term>'Main' colour - this is dependent on your Desktop theme - often blue by default</term>
<listitem><para>elevation data in graph</para></listitem>
</varlistentry>
<varlistentry>
<term>Yellow</term>
<listitem>
<para>no elevation data</para>
</listitem>
</varlistentry>
<varlistentry>
<term>Green</term>
<listitem>
<para>elevation data from DEM</para>
</listitem>
</varlistentry>
<varlistentry>
<term>Red</term>
<listitem>
<para>speed</para>
</listitem>
</varlistentry>
</variablelist>

</section>

<section><title>Track Operations</title>

<section><title>Goto</title>
<para>
This centers the viewport on the selected position on the track:
</para>
<itemizedlist>
<listitem><para>Startpoint</para></listitem>
<listitem><para>"Center" - the notional center from the bounds of the track</para></listitem>
<listitem><para>Endpoint</para></listitem>
<listitem><para>Version1.1+: Highest Altitude</para></listitem>
<listitem><para>Version1.1+: Lowest Altitude</para></listitem>
<listitem><para>Version1.1+: Maximum Speed</para></listitem>
</itemizedlist>
</section>

<section><title>View</title>
<para>
Version1.1+: This centers the viewport on the track and selects the best zoom level to see it.
</para>
</section>

<section><title>Merge By Time</title>
<para>
This operation repeatedly tries to merge the right-clicked track
with tracks in the same TrackWaypoint layer. The tracks which are
merged are those which have at least one trackpoint less than some
threshold time away. This way, if you somehow end up with lots of small
segments (say, caused by turning the GPS on and off) you can merge them
easily into one track.
</para>
</section>

<section><title>Merge With Other Tracks</title>
<para>
This opens a dialog listing the other tracks in the same TrackWaypoint layer, from which one can select the other tracks to merge with.
</para>
</section>

<section><title>Split By Time</title>
<para>
This operation will split a single track into segments wherever the
time interval between successive trackpoints is larger than some
threshold. This is useful when processing raw NMEA GPS data, especially
taken over a long time.
</para>
</section>

<section><title>Split By Number of Points</title>
<para>
Version1.2+: This operation will split a single track into segments by the number of points specified.
This can be useful with devices which may have limits on the number of points it supports.
</para>
</section>

<section><title>Apply DEM data</title>
<para>
If any DEM data is loaded, this will apply the DEM data to give the track elevation data.
</para>
</section>

<section><title>Export Track as GPX</title>
<para>
Version1.1+: This allows exporting the track as a GPX file by opening a file save dialog.
</para>
</section>

<section><title>Extend Track End</title>
<para>
Changes the current tool to add trackpoints to the end of the track.
</para>
</section>

<section><title>Extend Using Route Finder</title>
<para>
Enables the Route Finder tool. Thus on a subsequent left click in the viewport, a route is calculated from the end of track to that point using Google's route service and applied to the track.
</para>
</section>

<section><title>Upload to OSM</title>
<para>
Same as the layer <link linkend="osm_upload">Upload to OSM</link>, but only applies to the track.
</para>
</section>

<section><title>Use With Filter</title>
<para>
This selects the track to be used in the <link linkend="filter_with_track">Filter With <emphasis>Trackname</emphasis></link> feature.
</para>
</section>

<section><title>View Google Directions</title>
<para>
This option is only available on a track created using the Route Finder tool.
</para>
<para>
Launch a web browser to see the Google directions page which yielded the route.
</para>
<note>
<para>
The record of the Google route is stored in the track's comment, so if the comment is changed (or the route was created by something other than the Route Finder tool) this will not work correctly.
</para>
</note>
</section>

</section><!-- End Track Options -->

<section><title>Waypoint Properties</title>

<para>
This shows a dialog with detailed information for the waypoint. Many properties of the waypoint can changed here, such as the comment, the symbol used in drawing or the image (normally a photograph taken at this position) assiocated with it. When a waypoint has an image, a thumbnail of it is drawn in the viewport for the waypoint (in preference to the symbol).
</para>
<para>
If the waypoint has an associated image, then the Geotag information may be updated, either with updating the file's modification timestamp or not.
This can be useful when the waypoint has been moved.
</para>

</section><!-- WP Prop END -->

<section><title>Waypoint Operations</title>

<section><title>Goto</title>
<para>
This centers the viewport on the selected waypoint.
</para>
</section>

<section><title>Visit Geocache Webpage</title>
<para>
If the waypoint's name is in Geocache form (GCXXXXX) you can launch a web browser to go to the Geocache page.
</para>
</section>

<section><title>New Waypoint</title>
<para>
Same as the layer <link linkend="new_wp">New Waypoint</link>.
</para>
</section>

</section><!-- WP END -->

<section id="geotagging"><title>Version1.3+: Geotag Images</title>
<para>
This dialog allows geotagging images (normally taken with a digital camera) via interpolation against a specific track or all tracks in the TrackWaypoint layer - depending on how it is invoked.
</para>
<para>
Images need to have an EXIF DATE_TIME_ORIGINAL (nearly always set by a camera). This timestamp is then used to find the location when the image(s) was taken by searching through the track(s) to find the nearest time - interpolating between points if necessary to set the location.
</para>
<note>
<para>
Generally it is good policy to synchronize your camera's clock with your GPS clock before taking photographs. However the times can be adjusted afterwards (if necessary) to take into consideration clock differences.
</para>
</note>
<para>
Various options allow control of how the geotagging process is performed:
</para>
<itemizedlist>
<listitem><para>Images - Add the images used for geotagging</para></listitem>
<listitem><para>Create Waypoints</para></listitem>
<listitem><para>Write EXIF</para></listitem>
<listitem><para>Overwrite Existing GPS Information</para></listitem>
<listitem><para>Interpolate Between Track Segments</para></listitem>
<listitem><para>Image Time Offset - The number of seconds to ADD to the photos time to make it match the GPS data. Calculate this with (GPS - Photo). Can be negative or positive. Useful to adjust times when a camera's timestamp was incorrect.</para></listitem>
<listitem><para>Image Timezone - The timezone that the used when the images were created. For example, if a camera is set to AWST or +8:00 hours. Enter +8:00 here so that the correct adjustment to the images' time can be made. GPS data is always in UTC.</para></listitem>
</itemizedlist>
</section>

</section><!-- TRW Layer END -->

<section><title>GPS Layer</title>
<para>
The GPS layer is responsible for uploading and downloading GPS data
from a GPS device. It also is responsible for realtime GPS tracking.
Expand the GPS layer in the layers panel to see the two TrackWaypoint layers it
uses for uploading and downloading. To upload, download, or use
realtime tracking, right-click the GPS layer and click the appropiate
menu item.
</para>

<section><title>Download</title>
<para>
To download data from the GPS, right-click the GPS layer and click <guimenuitem>Download from GPS</guimenuitem>.
</para>
</section>

<section><title>Upload</title>
<para>
To upload data to the GPS, first populate the GPS Upload child
layer of the GPS layer (either by creating waypoints/tracks in it, or
copying and pasting or dragging waypoints/tracks from another layer).
Then right-click the GPS layer and click <guimenuitem>Upload to GPS</guimenuitem>.
</para>
</section>

<section><title>Realtime Tracking</title>
<para>
You must set up gpsd correctly or use a GPSD server and put the
correct information in the GPS layer properties dialog. Then right-click
the layer and select <guimenuitem>Start Realtime Tracking</guimenuitem>.
</para>
</section>

<section><title>Empty <emphasis>Item</emphasis></title>
<para>
There are several options to quickly delete a subsection of data:
</para>
<itemizedlist>
<listitem><para>Empty Realtime</para></listitem>
<listitem><para>Empty Upload</para></listitem>
<listitem><para>Empty Download</para></listitem>
<listitem><para>Empty All</para></listitem>
</itemizedlist>
</section>

</section><!-- End GPS -->

<section><title>DEM (Digital Elevation Model) Layer</title>
<para>
This layer provides elevation data from the <ulink url="http://www2.jpl.nasa.gov/srtm/">Shuttle Radar Topography Mission (SRTM)</ulink>
</para>
<para>
Elevation data can be useful in planning trips, as you many wish to avoid/minimise the hills encountered. [OSM Cyclemap is also useful this way too]
</para>
<para>
To download the data use the DEM Download tool (shown on the toolbar), and then click on a area of the viewport. Once files have been downloaded they can then be loaded from disk via the DEM properties in future application runs.
</para>
<para>
The current data server is: <ulink url="http://dds.cr.usgs.gov/srtm/version2_1/">NASA STRM 2.1</ulink>.
</para>
<para>
ATM &appname; does not auto download DEM data. If you want to get lots of data blocks, you may wish to use some other program get such as <application>curl</application> or <application>wget</application> to download them for an area.
</para>
<note>
<para>
Using many DEMs is CPU/memory intensive. Depending on your computer's capability, &appname; will be less responsive when about 50+ DEM blocks are loaded. It is probably unwise to attempt using 200+ blocks, so trying to use DEMs covering large countries/continents (USA, Australia etc...) is unlikely to work. In these conditions under Linux, &appname; may be automatically stopped by the "<ulink url="http://en.wikipedia.org/wiki/Out_of_memory/">OOM</ulink> Killer"
</para>
</note>

</section><!-- End DEM -->


<section><title>Maps Layer</title>
<para>
This layer provides a single map resource, you may have multiple map layers but only top one (if enabled) will be visible.
You will need an open internet connection when you are downloading maps, but once downloaded they are available from the hard disk cache. When map are avaliable from the disk cache it is much faster and can be used offline.
</para>
<para>
Some maps are continually improving over time (e.g. OpenStreetMap) and so in order to not to have to (re)download the data all the time &appname; employs a timeout method - 'Tile Age' to determine whether to access the server. However a forced refresh for the current view can be made via the <guilabel>Reload All Onscreen Maps</guilabel> option.
</para>
<para>
Inbuilt maps include various <ulink url="http://en.wikipedia.org/wiki/TerraServer-USA">Terraserver</ulink> (Primarily USA coverage) and <ulink url="http://openstreetmap.org/">OpenStreetMap (OSM)</ulink> ones and more:
</para>
<itemizedlist>
<listitem><para>Bing Bird's Eye (Aerial) Maps (&appname; Version1.2+)</para></listitem>
<listitem><para>Terraserver Topos</para></listitem>
<listitem><para>Terraserver Aerials</para></listitem>
<listitem><para>Terraserver Urban Areas</para></listitem>
<listitem><para>OpenStreetMap (Mapquest) - This is the default (&appname; Version1.3+)</para></listitem>
<listitem><para>OpenStreetMap (Mapnik)</para></listitem>
<listitem><para>OpenStreetMap (Cycle)</para></listitem>
<listitem><para>OpenStreetMap (Transport) (&appname; Version1.3+)</para></listitem>
<listitem><para>NASA BlueMarble</para></listitem>
<listitem><para>SpotMap (&appname; Version1.1+)</para></listitem>
</itemizedlist>

<para>
&appname; can be configured to handle additional maps. See <link linkend="extend_viking">Extending &appname;</link> for further detail.
</para>

<section><title>Layer Operations</title>
<section><title>Download Missing Onscreen Maps</title>
<para>
This requests map tiles for areas of the viewport that do not currently have one.
</para>
</section>

<section><title>Download New Onscreen Maps</title>
<para>
This requests map tiles only if the maps are older than the Tile Age preference.
</para>
</section>

<section><title>Reload All Onscreen Maps</title>
<para>
Force a refresh of all visible map tiles.
</para>
</section>
</section>


</section><!-- End Maps -->

<section><title>Aggregrate Layer</title>
<para>
This layer is a container layer to hold other layers. There is always an initial and controlling 'Top Layer' that can not be removed, although it can be renamed.
</para>
<para>
This layer type is useful for grouping other layers, especially TrackWaypoint layers, in whatever categories are relevant to you: such as by activity, location or date.
Here are some suggestions:
<itemizedlist>
<listitem><para>Hiking</para></listitem>
<listitem><para>Mountain Biking</para></listitem>
<listitem><para>Road Cycling</para></listitem>
<listitem><para>Car Trips</para></listitem>
<listitem><para>Sailing</para></listitem>
<listitem><para>Holidays</para></listitem>
<listitem><para>UK Points of Interest</para></listitem>
<listitem><para>USA Points of Interest</para></listitem>
<listitem><para>etc...</para></listitem>
</itemizedlist>
</para>
<para>
Thus one can have a list of all your tracks, but groups can be shown or not using the relevant layers visibility checkbox.
</para>

<para>
This layer only has one operation: <guilabel>New Layer</guilabel>
</para>

<section><title>New Layer</title>
<para>
Add a new layer of the selected type.
</para>
</section>

</section><!-- End Agg -->

<section><title>GeoRef Layer</title>
<para>
This layer allows one to use any image as a map. You will need to tell it how to align the map to a position in the world and the scale of map.
</para>
<section><title>Layer Operations</title>
<section><title>Zoom to Fit Map</title>
<para>
Automatically set a zoom level to see the entire map coverage.
</para>
</section>

<section><title>Goto Map Center</title>
<para>
Center the viewport on this map.
</para>

</section>
<section><title>Export to World File</title>
<para>
Opens a file save dialog to save the scale and position information as a <ulink url="http://en.wikipedia.org/wiki/World_file">World File</ulink>.
</para>
</section>
</section>

</section><!-- End GeoRef -->

<section><title>Coord Layer</title>
<para>
This layer is allows drawing of grid lines on the viewport.
</para>
</section><!-- End Coord -->

</section>

<section><title>Tools</title>
<para>
You can use the scroll wheel and the right-click to zoom and pan no matter what tool you are using.
</para>
<para>
Scroll: zoom in and out without changing the center (also Ctrl+, Ctrl- [*not* KeyPad +/-])
</para>
<para>
Ctrl-scroll: pan north-south (also Ctrl-up, Ctrl-down)
</para>
<para>
Shift-scroll: pan east-west (also Ctrl-left, Ctrl-right)
</para>
<para>
Ctrl-shift-scroll: zoom in and out, keeping mouse over same location (like Google maps)
</para>
<para>
Left or Middle-click: make the clicked point on the map the center
</para>
<para>
Middle-click and drag: pan
</para>

<section><title>Pan</title>
<para>
Pan moves the viewpoint. A single click centers the viewport at that point, whereas click and drag dynamically moves the view around.
This is the default tool.
</para>
</section>

<section><title>Zoom</title>
<para>
Zooms in and out on the clicked part of the map.
</para>
</section>

<section><title>Ruler</title>
<para>
The ruler is used to measure the bearing and distance between two points: Click on first point and then move the mouse point around - the values will be continually updated.
A second click will 'freeze' the ruler at that point.
</para>
</section>

<section><title>Version1.1+: Select</title>
<para>
The select tool allows one to choose any waypoint or track by clicking on it (or reasonably near) in the viewpoint.
</para>
<para>
ATM to select a track one must actually click on a trackpoint, which is also selected.
</para>
</section>

<section><title>TrackWaypoint Layer Tools</title>
<para>
You must have a TrackWaypoint Layer selected to use these tools.
</para>
<section><title>Create Waypoint</title>
<para>
Left click will open the new waypoint dialog using the specified position.
</para>
</section>

<section><title>Create/Begin Track</title>
<para>
Left click to create a new trackpoint. If it's the initial trackpoint you will be asked to enter a name for the track.
If <keycap>Ctrl</keycap> is held at the same time, it will jump the new trackpoint position to a nearby existing trackpoint.
Right click or <keycap>Backspace</keycap>: undo one point.
</para>
<para>
Double click or <keycap>Escape</keycap>: finish track creation.
</para>
</section>

<section><title>Edit Waypoint</title>
<para>
Left Click/drag: select/move a waypoint.
If <keycap>Ctrl</keycap> is held at the same time, it will jump the waypoint position to a nearby existing trackpoint.
If <keycap>Shift</keycap> is held at the same time, it will jump the waypoint position to a nearby existing waypoint.
</para>
<para>Right-click on waypoint: opens a menu with waypoint actions (the
same menu accessed by right-clicking the waypoint in the layers panel)
</para>
</section>

<section><title>Edit Trackpoint</title>
<para>
Left click near a trackpoint (in screen pixel terms) to bring up the Track Point Edit dialog on that trackpoint.
Whilst the edit dialog is already open, left click again and drag enables moving of the trackpoint.
If <keycap>Ctrl</keycap> is held at the same time, it will jump the new trackpoint position to a nearby existing trackpoint.
</para>
<para>
Options in the Track Point Edit dialog include: change position, go to next, go to previous, delete, insert (halfway to next trackpoint) and splitting the track.
</para>
</section>

<section><title>Show Picture</title>
<para>
Opens an image viewer with the picture associated with the waypoint.
On Linux this uses <application>eog</application>.
On Windows this uses the default system image viewer.
</para>
</section>

<section><title>Route Finder</title>
<para>Creates a track using Google maps routing between two points.
Requires an internet connection. Click one point, then click another to
create a track.
</para>
<para>
Right-click: undo last routing (only track removed - not any waypoints)
</para>
<para>
<keycap>Ctrl</keycap>: continue previous track
</para>
</section>

</section>

<section><title>Georef Map Layer Tools</title>
<para>
You must have a Georef Map Layer selected to use these tools.
</para>
<section><title>Georef zoom</title>
<para>Changes the zoom level of the georeferenced map and changes the
&appname; zoom level accordingly. Useful if you are trying to match GPS
data to a georeferenced map.
</para>
</section>

<section><title>Georef move</title>
<para>
Drag to move the georeferenced map.
</para>
</section>
</section>

<section><title>Map Download</title>
<para>
You must have a Map Layer selected to use this.
</para>
<para>
Click to download a single tile. Drag to download tiles in the dragged rectangle area.
</para>
<para>
Right-click to redownload bad/all tiles. Right-click and drag to redownload bad/all tiles in the dragged rectangle area.
</para>
</section>

<section><title>DEM Download</title>
<para>
You must have a DEM Layer selected to use this.
</para>
<para>
Click to download and import a DEM file.
</para>
</section>

<section><title>Webtools</title>
<para>
Many services are available only via a web browser (Google Maps, OpenStreetMap Potlach editor, etc.).
</para>
<para>
Jumping from &app; to such service can become annoying.
</para>
<para>
&appname; allows you to open such service directly at the position currently viewed in &app;.
</para>
<para>
This feature is called <guilabel>Webtools</guilabel>. It is also known as External Tools.
</para>
</section>

</section>

<!-- Preferences -->
<section id="prefs"><title>Preferences</title>
<section><title>General</title>
<section><title>Localisation</title>
<para>You can select units displayed by &appname; to best fit your usage.</para>
<figure>
<title>Properties dialog: units part</title>
<screenshot>
  <graphic format="PNG" fileref="figures/properties_units.png"/>
</screenshot>
</figure>
<para>Concerning degrees, you can select the way to display them:
<variablelist>
<varlistentry>
<term>DDD</term><listitem><para>decimal degree</para></listitem>
</varlistentry>
<varlistentry>
<term>DDD</term><listitem><para>partial sexagesimal display: degrees, minutes and d√©cimal part of minutes</para></listitem>
</varlistentry>
<varlistentry>
<term>DMS</term><listitem><para>sexagesimal display: degrees, minutes and seconds</para></listitem>
</varlistentry>
</variablelist>
</para>
<figure>
<title>Properties dialog: degree display options</title>
<screenshot>
  <graphic format="PNG" fileref="figures/properties_degree.png"/>
</screenshot>
</figure>
</section>
<section><title>Waypoint Icon Size</title>
<para>An option exists to control the icon (symbol) size used for waypoints
</para>
</section>
<section><title>'Home' Default Location: Latitude and Longitude</title>
<para>You can set the 'Home' location directly by inputting the latitude and longitude in decimal degrees.
</para>
</section>
<section><title>Tile's age</title>
<para>This age is used to decided wether or not a new request to tile server must be done.
</para>
<para>Changing this value, you will increase or decrese the network load.</para>
</section>
<section><title>Default maplayer directory</title>
<para>This property sets the default directory of the tiles cache.
This value is used when you create a new map layer.
</para>
<para>You are still able to change this value in each map layer properties.</para>
</section>
<section><title>Map Cache Memory Size</title>
<para>This controls the amount of maps that are stored in memory, rather than having to reread from disk.
Generally if you have a system with lots of memory it's recommended to increase this value.
</para>
</section>
</section>

<section><title>Export/External</title>
<section><title>KML Export Units</title>
<para>Allows setting the units used when saved as the KML file type, such as Metric or Statue units</para>
</section>
<section><title>Image Viewer (Not Windows)</title>
<para>Allows setting the program used to view images associated with Waypoints.</para>
<para>By default this is set to 'xdg-open' which should open the system's default image viewer, however this can be overridden with this setting.</para>
<para>Note: for Windows systems, viewing images associated with Waypoints always uses the system's default image viewer.</para>
</section>
<section><title>External GPX programs</title>
<para>Allows setting the programs invoked via the TrackWaypoint Layer -> Export Layer -> Open With 'program'</para>
<para>Two options are given so that it can be configured for various uses such as:</para>
<itemizedlist>
<listitem><para>An OSM editor (default)</para></listitem>
<listitem><para>Some other user defined program</para></listitem>
</itemizedlist>
</section>
</section>

<section id="prefs_osm"><title>OpenStreetMap Traces</title>
<section><title>OSM Username + Password</title>
<para>Store your OSM details here, so that you don't need to enter it in every time in the <link linkend="osm_upload">Upload to OSM</link> procedure.</para>
<warning>
<para>
Your OSM password will be stored in plain text.
</para>
</warning>
</section>
</section>

</section>

<!-- HOWTOS-->
<section><title>Mini-Howto's</title>
<section><title>Getting Started</title>
<para>
To quickly get started using &appname;, follow these instructions.
</para>
<section><title>Go to an area of interest</title>
<para>
&appname;'s default location is a Manhatten, New York, USA, so you may need to pick another place that interests you.
</para>
<procedure>
<title>Method A</title>
<step>
<para>
Use View - Go to to move to a coordinate of interest. 
</para>
</step>
</procedure>
<procedure>
<title>Method B</title>
<step>
<para>Use the GPS Layer or <menuchoice><guimenu>File</guimenu><guimenuitem>Acquire</guimenuitem><guimenuitem>From GPS</guimenuitem></menuchoice>
to load data directly from your GPS into &appname;.
Currently Garmin, Magellan, DeLorme and Navilink protocols are supported.
</para>
<note>
<para>You must have write permission to the port used. For Unix like OS:</para>
<para>/dev/ttyS0 is the first serial port</para>
<para>/dev/ttyUSB0 is the first USB port</para>
</note>
<note><para>For DeLorme device support you will need GPSBabel v1.4.0+ installed</para></note>
</step>
</procedure>
<procedure>
<title>Method C</title>
<step>
<para>
Get data from files in GPX or KML format, which can be opened directly.
Use <menuchoice><guimenu>File</guimenu><guimenuitem>Open</guimenuitem></menuchoice>
</para>
<para>
Other formats can be imported that are supported by GPSBabel.
<menuchoice><guimenu>File</guimenu><guimenuitem>Acquire</guimenuitem><guimenuitem>Import File With GPSBabel...</guimenuitem></menuchoice>
</para>
</step>
<step>
<para>
Expand Tracks or Waypoints. Right-click on the
track or waypoint of interest and select <guimenuitem>Goto "Center"</guimenuitem>.
</para>
</step>
</procedure>
</section>
<section><title>Add a map layer</title>
<para>
1. Use Layers - New Map Layer, and choose a suitable cache directory
where you would like to store your tracks and click <guilabel>OK</guilabel>. Zoom to a
comfortable level (I suggest 4 mpp) by clicking the left and right
mouse buttons on the gray area where your tracks are. Now from the menu
choose Tools - Map Download, Click where you would like to download a
map. Regardless of what tool you are using, the middle mouse button
always pans. </para>
<note>
<para>
You need an open internet connection when you are downloading maps.
</para>
</note>
<para>
1. You will notice the maps are being drawn on top of the tracks, which
is probably not what you want. Look at the Layers Panel to the left.
Notice how the layer named Map is ABOVE your TrackWaypoint layer that
your GPS data is in. This means that it will be drawn last, or on top
of the other layers. Select the Map layer from the list and click the
down arrow button beneath the list. Your tracks will now be drawn over
the map. </para>

</section>

</section>
<section><title>From 1st startup to GPS track (including offline maps)</title>
<para>
The first you'll see is an empty map, because &appname; in its default configuration will download maps only on demand.
Before fetching unneeded data, one can position to a location of interest, e.g. Stuttgart: <menuchoice><guimenu>View</guimenu><guimenuitem>Go to Location</guimenuitem></menuchoice>, enter 'Stuttgart'.
</para>

<section><title>Fetching the maps</title>
<para>
<emphasis role="bold">Map</emphasis>
</para>
<procedure>
<step><para><menuchoice><guimenu>Layers</guimenu><guimenuitem>New Map Layer</guimenuitem></menuchoice></para></step>
<step><para>in the layer properties dialogue choose e.g. <guilabel>OpenStreetMap (Mapnik)</guilabel>.</para></step>
<step>
<para>For the moment, we keep the default <guilabel>Maps Directory</guilabel> (the directory in
which the maps will be stored and can be used for offline usage).</para>
</step>
<step>
<para>Check <guilabel>Autodownload maps</guilabel> and keep the zoom level as <guilabel>Use Viking
Zoom Level</guilabel>.</para>
<note>
<para>
however, that these settings will play an important
role in the pre-fetch for offline usage discussed later
</para>
</note>
</step>
</procedure>
<para>You'll see a map of Stuttgart. Using the mouse wheel, you can
zoom in and out. The maps for the choosen resoltion will be downloaded
automatically.
</para>
<para>
<emphasis role="bold">DEM Layer (Height Map)</emphasis>
</para>
<procedure>
<step><para>Zoom out to 512.</para></step>
<step><para><menuchoice><guimenu>Layers</guimenu><guimenuitem>New DEM Layer</guimenuitem></menuchoice></para></step>
<step><para>Keep the download source as is (SRTM Global 90m), hit <guilabel>OK</guilabel>.</para></step>
</procedure>

<para>In the layer listing on the left, the DEM layer should reside
above the map layer. If this is not the case, highlight the DEM layer
an shift it one up (using the arrow up button).
</para>
<procedure>
<step><para>highlight the DEM layer in the layer listing on the left</para></step>
<step><para>in the toolbar, check DEM layer download/import (the last symbol)</para></step>
<step><para>a left-click in the map window should then fetch the DEM data</para></step>
</procedure>
<para>
This might take some time.
</para>
<para>
Sometimes, a tile does not show up correctly (you might see only a
black frame in the map window) because it got corrupted during
transfer. In order to correct this, you can delete the corresponding
datafile in the cache. <programlisting> right-click the DEM layer properties</programlisting>
</para>
<para>
The <guilabel>DEM Files</guilabel> listing allows you to delete the specific tiles (alternatively do this from the command line).
</para>
<para>
You can also alter the Min. and Max. elevation in this dialogue.
</para>

</section>
<section><title>GPS Track with Height Profile</title>
<procedure>
<step><para>uncheck the DEM layer (the map show up again)</para></step>
<step><para><menuchoice><guimenu>Layers</guimenu><guimenuitem>New TrackWaypoint Layer</guimenuitem></menuchoice></para></step>
</procedure>
<para>
Ensure the new track layer is above the map layer.
</para>
<procedure>
<step><para>expand trackwaypointlayer, select <guimenuitem>Tracks</guimenuitem></para></step>
<step>
<para>
in the tools menu choose <guimenuitem>Begin Track</guimenuitem> which looks like this:
<figure>
<title>Begin Track Icon</title>
<screenshot>
  <graphic format="PNG" fileref="figures/begintr_18.png"/>
</screenshot>
</figure>
</para></step>
<step><para>leftclick in the map window, enter a name</para></step>
<step><para>click several times to generate a track (a right-click removes the last point)</para></step>
<step><para>expand tracks in the layer menu, your track should show up, select it</para></step>
<step><para>right click your track, select <guimenuitem>Apply DEM data</guimenuitem></para></step>
<step><para>right click your track again, select <guimenuitem>Properies</guimenuitem></para></step>
<step><para>click the tab <guilabel>Elevation-distance</guilabel> - enjoy the plot</para></step>
</procedure>
<para>
In order to save this setting for later usage
</para>
<procedure>
<step><para>click <guilabel>OK</guilabel> in the <guilabel>Track Properties</guilabel> dialog</para></step>
<step><para><menuchoice><guimenu>File</guimenu><guimenuitem>Save As</guimenuitem></menuchoice>, choose a name (you can open this <emphasis>view</emphasis> later via <menuchoice><guimenu>file</guimenu><guimenuitem>Open</guimenuitem></menuchoice>).</para></step>
</procedure>

</section>
<section><title>Usecase: offline data for holiday</title>
<para>
Suppose you want to have the map and DEM data offline for your holiday in Italy near Bologna.
</para>
<procedure>
<step><para>Start a new &appname; session.</para></step>
<step><para><menuchoice><guimenu>View</guimenu><guimenuitem>Go to Location</guimenuitem></menuchoice>, enter Bologna</para></step>
<step><para><menuchoice><guimenu>Layers</guimenu><guimenuitem>New Map Layer</guimenuitem></menuchoice></para></step>
<step><para>Choose e.g. <guilabel>OpenStreetMap (mapnik)</guilabel>.</para></step>
<step><para>adapt the <guilabel>maps directory</guilabel> e.g. to <filename>/home/user/.viking-map-holiday/</filename>.
This allows you to delete the map stuff after holiday without purging the rest of your maps.
</para></step>
<step><para>check <guilabel>autodownload map</guilabel></para></step>
<step><para>keep <guilabel>viking zoom level</guilabel></para></step>
<step><para>zoom out to 1024</para></step>
<step><para>add a DEM layer (as discussed above)</para></step>
<step><para>download the DEM data</para></step>
</procedure>
<para>In the &app; version discussed here, the DEM data automatically
are stored in <filename>/home/user/.viking-maps/</filename>. You can move the corresponding
tiles into <filename>.viking-map-holiday/</filename> if you like.
</para>
<para>
<emphasis role="bold">Download map data for all zoom levels</emphasis>
</para>
<procedure>
<step><para>uncheck the DEM layer for the map to show up</para></step>
<step><para>navigate the map to be centered at Bologna</para></step>
<step><para>choose the zoom such, that all regions of interest are displayed in the map window (e.g. 1024)</para></step>
<step>
<para>follow this sequence until you have all tiles for all zoom levels you need</para>
<substeps>
<step><para>right-click the map layer properties</para></step>
<step><para>set the zoomlevel explicitely one below the last (in the first cycle 512), hit OK</para></step>
<step><para>right click the map layer  <guimenuitem>Download Missing Onscreen Maps</guimenuitem></para></step>
<step><para>wait until all tiles for that resolution have been downloaded</para></step>
</substeps>
</step>
</procedure>
<para>This may take some time and hd capacity. Lixus wrote a set of
scripts which allow to download the map tiles for several zoom-level in
parallel from the command line.
</para>
<para>
Do not forget to save your configuration (as discussed above).
</para>

</section>

</section>
<section><title>OpenStreetMap project</title>
<para>
<ulink url="http://openstreetmap.org/">OpenStreetMap (OSM)</ulink> is a collaborative project to create a free editable map of the world.
One of sources of data for this project is GPS tracks.
&appname; supports this project via the GPS Traces methods, both uploading and downloading such data.
</para>
<section><title>Uploading data to OpenStreetMap</title>
<para>
It is possible to upload data directly from &appname; to OpenStreetMap.
</para>
<formalpara>
<title>Upload a layer</title>
<para>
One solution is to upload whole a TrackWaypoint layer. To do this,
simply select the layer and right click on it. Then, select <guimenuitem>Upload to
OSM</guimenuitem>.
</para>
</formalpara>
<formalpara>
<title>Upload a single track</title>
<para>One solution is to upload whole a TrackWaypoint layer. To do
this, simply select the layer and right click on it. Then, select
<guimenuitem>Upload to OSM</guimenuitem>.
</para>
</formalpara>
<formalpara>
<title>Fill in the form</title>
<para>
In both cases, &appname; will retain some information.
The email field is the email you used to subscribed into OpenStreetMap.
The password field is the password you used with this account.
The filename is the name you want your upload has on the server. This information is displayed by the osm server.
The description is some descriptive information.
The tags field is a white separated list of tag.
</para> 
</formalpara>
</section>
<section><title>Downloading traces from OpenStreetMap</title>
<para>
It is possible to download GPS traces directly from OpenStreetMap into &appname;.
This feature can be really useful for checking existing data before uploading new ones.
</para>
<formalpara>
<title>Download all visible tracks</title>
<para>One solution is to select
<menuchoice>
<guimenu>File</guimenu>
<guisubmenu>Acquire</guisubmenu>
<guimenuitem>OSM traces...</guimenuitem>
</menuchoice>.
Each request can get up to 5,000 points.
The dialog box allows setting which group of 5,000 points to get. These groups are known as 'Page Numbers' which start at 0.
Increasing the page number parameter allows one to request the subsequent sets of point groups.
See <ulink url="http://wiki.openstreetmap.org/wiki/API_v0.6#GPS_Traces"/> for further detail.
</para>
</formalpara>
</section>
</section>

<section id="extend_viking">
    <title>Extending Viking</title>

      <para>Currently, &app; has some extention points based on configuration files. The file format is heavily inspired by the GtkBuilder file format: you specify the class of the GObject to build and set its properties. Technically, it is a XML file containing a "objects" root element. Inside this element, you set a collection of "object".</para>
      <para>Here is an example:
<programlisting><![CDATA[
<objects>
  <object class="ClassName">
    <property name="property_name1">Property value</property>
    <property name="property_name2">Property value</property>
  </object>
  ...
<objects>
]]>
</programlisting>
</para>
      <para>You can find more examples in the documentation part of the distribution.</para>
      <section>
        <title>Map Source</title>
        <para>It is possible to add new map's sources. The file is <filename>~/.viking/maps.xml</filename> for <trademark>UNIX</trademark> like systems and <filename>C:\Documents and Settings\<replaceable>username</replaceable>\.viking\maps.xml</filename> on <trademark>Windows XP</trademark>.</para>
        <para>An example of the file is in the distribution <filename>doc/examples/maps.xml</filename>. Further examples and values are online in the <ulink url="http://sourceforge.net/apps/mediawiki/viking/index.php?title=Maps">Maps Wiki</ulink></para>

        <para>The VikSlippyMapSource allows to declare any map's source working like OpenStreetMap. It supports the following properties:
          <variablelist>
            <varlistentry>
              <term>id</term>
              <listitem><para>this is an integer and should be unique as it used to identify the map source</para></listitem>
            </varlistentry>
            <varlistentry>
              <term>label</term>
              <listitem><para>the text displayed in the map's source selection dialog</para></listitem>
            </varlistentry>
            <varlistentry>
              <term>hostname</term>
              <listitem><para>the server's hostname (eg. "tile.openstreetmap.org")</para></listitem>
            </varlistentry>
            <varlistentry>
              <term>url</term>
              <listitem><para>the parametrized address of the tile, in the spirit of C printf format, with 3 "%d" fields for X, Y and Z (zoom level) (eg. "/%d/%d/%d.png")</para></listitem>
            </varlistentry>
          </variablelist>
        </para>
        <para>The VikTmsMapSource allows to declare any TMS service. It supports the following properties:
          <variablelist>
            <varlistentry>
              <term>id</term>
              <listitem><para>this is an integer and should be unique as it used to identify the map source</para></listitem>
            </varlistentry>
            <varlistentry>
              <term>label</term>
              <listitem><para>the text displayed in the map's source selection dialog</para></listitem>
            </varlistentry>
            <varlistentry>
              <term>hostname</term>
              <listitem><para>the server's hostname (eg. "tile.openstreetmap.org")</para></listitem>
            </varlistentry>
            <varlistentry>
              <term>url</term>
              <listitem><para>the parametrized address of the tile, in the spirit of C printf format, with 3 "%d" fields for X, Y and Z (zoom level) (eg. "/%d/%d/%d.png")</para></listitem>
            </varlistentry>
          </variablelist>
        </para>
        <para>The VikWmscMapSource allows to declare any WMS or WMS-C service. It supports the following properties:
          <variablelist>
            <varlistentry>
              <term>id</term>
              <listitem><para>this is an integer and should be unique as it used to identify the map source</para></listitem>
            </varlistentry>
            <varlistentry>
              <term>label</term>
              <listitem><para>the text displayed in the map's source selection dialog</para></listitem>
            </varlistentry>
            <varlistentry>
              <term>hostname</term>
              <listitem><para>the server's hostname (eg. "tile.openstreetmap.org")</para></listitem>
            </varlistentry>
            <varlistentry>
              <term>url</term>
              <listitem><para>the parametrized address of the tile, in the spirit of C printf format, with 4 "%s" fields for bounding box coordinates (eg. "/coord=%s,%s,%s,%s")</para></listitem>
            </varlistentry>
          </variablelist>
        </para>
      </section>

      <section>
        <title>Go-to search engines</title>
        <para>It is possible to add new new search engines for the "Go-To" feature. The file is <filename>~/.viking/goto_tools.xml</filename>.</para>
        <para>An example of the file in the distribution <filename>doc/examples/goto_tools.xml</filename>.</para>
        <para>Currently, there is a single object class available: VikGotoXmlTool. Such feature allows to declare any search engine using a XML format as result.</para>
        <para>The related properties are:
          <variablelist>
            <varlistentry>
              <term>label</term>
              <listitem><para>the text displayed in the <guilabel>Go-To</guilabel> dialog</para></listitem>
            </varlistentry>
            <varlistentry>
              <term>url-format</term>
              <listitem><para>the parametrized address of the query, in the spirit of C <function>printf</function> format, with a single "%s" field (replaced by the query string)</para></listitem>
            </varlistentry>
            <varlistentry>
              <term>lat-path</term>
              <listitem><para>XML path of the latitude (eg. <literal>/root/parent/elem</literal>)</para></listitem>
            </varlistentry>
            <varlistentry>
              <term>lat-attr (optional)</term>
              <listitem><para>name of the attribute (of previous element) containing the latitude</para></listitem>
            </varlistentry>
            <varlistentry>
              <term>lon-path</term>
              <listitem><para>XML path of the longitude (eg. <literal>/root/parent/elem</literal>)</para></listitem>
            </varlistentry>
            <varlistentry>
              <term>lon-attr (optional)</term>
              <listitem><para>name of the attribute (of previous element) containing the longiude</para></listitem>
            </varlistentry>
          </variablelist>
        </para>
        <para>As a facility (or readability) it is possible to set both path and attribute name in a single property, like an XPath expression. To do so, simply set both info in lat-path (or lon-path) in the following format: <literal>/root/parent/elem@attribute</literal>.</para>
      </section>

      <section>
        <title>Webtools</title>
        <para>It is possible to add new external tools. The file is <filename>~/.viking/external_tools.xml</filename>.</para>
        <para>An example of the file in the distribution <filename>doc/examples/external_tools.xml</filename>.</para>
        <para>Currently, there is a single object class available: VikWebtoolCenter. Such feature allows to declare any Webtool using a logic based on center coordinates and zoom level value.</para>
        <para>The related properties are:
          <variablelist>
            <varlistentry>
              <term>id</term>
              <listitem><para>this is an integer and should be unique as it used to identify the tool</para></listitem>
            </varlistentry>
            <varlistentry>
              <term>label</term>
              <listitem><para>the text displayed in the menu entry</para></listitem>
            </varlistentry>
            <varlistentry>
              <term>url</term>
              <listitem><para>the parametrized address of the tile, in the spirit of C printf format, with 3 "%d" fields for X, Y and Z (zoom level) (eg. "http://hostname/%d/%d/%d.png")</para></listitem>
            </varlistentry>
          </variablelist>
        </para>
      </section>

</section>

<section><title>What to Do if &appname; Does Not Seem to Work</title>
<para>
In order to get some information about what &appname; is doing, start it in verbose debug mode via the command line:
<programlisting>viking -dV</programlisting>
</para>
<para>
For instance you can check the correct URLs &appname; is using in requesting remote data for DEMs or map tiles in the verbose debug output.
E.g. Something like this for DEMs:
<screen>
** (viking:28778): DEBUG: curl_download_uri: uri=http://dds.cr.usgs.gov/srtm/version2_1/SRTM3/Eurasia/N48E008.hgt.zip
* About to connect() to dds.cr.usgs.gov port 80 (#0)
* Trying 152.61.128.95... * connected
* Connected to dds.cr.usgs.gov (152.61.128.95) port 80 (#0)
 GET /srtm/version2_1/SRTM3/Eurasia/N48E008.hgt.zip HTTP/1.1
User-Agent: viking/0.9.8 libcurl/7.18.2 GnuTLS/2.4.2 zlib/1.2.3.3 libidn/1.8
Host: dds.cr.usgs.gov
Accept: */*
 HTTP/1.1 200 OK
 Date: Sun, 26 Jul 2009 18:13:38 GMT
 Server: Apache
 Last-Modified: Tue, 21 Jul 2009 19:57:35 GMT
 ETag: eac3f8-1828f5-46f3caa76070a
 Accept-Ranges: bytes
 Content-Length: 1583349
 Content-Type: application/zip

* Connection #0 to host dds.cr.usgs.gov left intact
* Closing connection #0
** (viking:28778): DEBUG: dem_layer_add_file: /home/username/.viking-maps/srtm3-Eurasia/N48E008.hgt.zip
</screen>
Or for OSM Mapnik tile server:
<screen>
* About to connect() to tile.openstreetmap.org port 80 (#0)
*   Trying 193.63.75.28... * connected
* Connected to tile.openstreetmap.org (193.63.75.28) port 80 (#0)
 GET /13/4065/2748.png HTTP/1.1
User-Agent: viking/0.9.96 libcurl/7.20.1 GnuTLS/2.8.6 zlib/1.2.3.4 libidn/1.18
Host: tile.openstreetmap.org
Accept: */*

* HTTP 1.0, assume close after body
 HTTP/1.0 200 OK
 Date: Thu, 14 Oct 2010 22:18:42 GMT
 Server: Apache/2.2.8 (Ubuntu)
 ETag: "b66ff9d46474bab68262a3483428a232"
** (viking:16704): DEBUG: curl_get_etag_func: ETAG found: "b66ff9d46474bab68262a3483428a232"
 Content-Length: 17194
 Cache-Control: max-age=94805
 Expires: Sat, 16 Oct 2010 00:38:47 GMT
 Content-Type: image/png
 Age: 5153
 X-Cache: HIT from konqi.openstreetmap.org
 X-Cache-Lookup: HIT from konqi.openstreetmap.org:3128
 Via: 1.1 konqi.openstreetmap.org:3128 (squid/2.7.STABLE7)
 Connection: close
 
* Closing connection #0
* About to connect() to a.andy.sandbox.cloudmade.com port 80 (#0)
*   Trying 178.63.75.195... ** (viking:16704): DEBUG: curl_download_uri: uri=http://tile.openstreetmap.org/13/4065/2749.png
* About to connect() to tile.openstreetmap.org port 80 (#0)
*   Trying 193.63.75.28... * connected
* Connected to a.andy.sandbox.cloudmade.com (178.63.75.195) port 80 (#0)
 GET /tiles/cycle/13/4065/2747.png HTTP/1.1
User-Agent: viking/0.9.96 libcurl/7.20.1 GnuTLS/2.8.6 zlib/1.2.3.4 libidn/1.18
Host: a.andy.sandbox.cloudmade.com
Accept: */*

* connected
* Connected to tile.openstreetmap.org (193.63.75.28) port 80 (#0)
 GET /13/4065/2749.png HTTP/1.1
User-Agent: viking/0.9.96 libcurl/7.20.1 GnuTLS/2.8.6 zlib/1.2.3.4 libidn/1.18
Host: tile.openstreetmap.org
Accept: */*

* HTTP 1.0, assume close after body
 HTTP/1.0 200 OK
 Date: Thu, 14 Oct 2010 23:44:35 GMT
 Server: Apache/2.2.8 (Ubuntu)
 ETag: "8e520ad47ce9c1b63430554886eb5fab"
** (viking:16704): DEBUG: curl_get_etag_func: ETAG found: "8e520ad47ce9c1b63430554886eb5fab"
 Content-Length: 18094
 Cache-Control: max-age=87742
 Expires: Sat, 16 Oct 2010 00:06:57 GMT
 Content-Type: image/png
 X-Cache: MISS from konqi.openstreetmap.org
 X-Cache-Lookup: MISS from konqi.openstreetmap.org:3128
 Via: 1.1 konqi.openstreetmap.org:3128 (squid/2.7.STABLE7)
 Connection: close
</screen>
</para>
</section>

</section>

<section><title>Dependencies</title>
<formalpara><title>gpsbabel</title>
<para>&appname; uses <ulink url="http://gpsbabel.org/">GPSBabel</ulink> to convert data.</para>
</formalpara>
<formalpara><title>unbuffer (optional)</title>
<para>&appname; uses unbuffer command to optimize conversion calls.</para>
</formalpara>
</section>

</article>
